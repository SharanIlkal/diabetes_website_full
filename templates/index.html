<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DiabPredict — Live</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
      :root { --card-radius: 14px; --accent: #3b82f6; --nav-grad-1: #4f46e5; --nav-grad-2: #06b6d4; }
      body { background: linear-gradient(180deg,#f8fafc,#ffffff); min-height:100vh; }
      .card { border-radius: var(--card-radius); box-shadow: 0 6px 20px rgba(15,23,42,0.06); }
      .gauge-legend { font-weight:700; font-size:0.95rem; }
      .input-small { max-width:220px; }
      @media (max-width: 767px) { .input-small { max-width:100%; } }

      /* ---------- Aesthetic navbar styles ---------- */
      .navbar-custom { background: linear-gradient(90deg,var(--nav-grad-1), var(--nav-grad-2)); border-radius: 12px; padding: .35rem .75rem; }
      .navbar-custom .navbar-brand { color: #fff; font-weight:700; letter-spacing: .2px; }
      .navbar-custom .nav-pills .nav-link {
        border-radius: 999px; /* pill */
        padding: .45rem .9rem;
        margin: 0 .25rem;
        color: rgba(255,255,255,0.9);
        background: transparent;
        border: 1px solid rgba(255,255,255,0.08);
        transition: all .18s ease-in-out;
        box-shadow: none;
      }
      .navbar-custom .nav-pills .nav-link.active,
      .navbar-custom .nav-pills .nav-link:hover {
        background: rgba(255,255,255,0.14);
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(2,6,23,0.12);
      }
      .nav-cta { background: #fff; color: var(--nav-grad-1); font-weight:700; border-radius: 999px; padding: .4rem .9rem; box-shadow: 0 6px 18px rgba(2,6,23,0.12); }
      .nav-cta:hover { transform: translateY(-2px); }
      .navbar-toggler { border: none; }
      .navbar-toggler-icon { background-image: none; }
      .toggler-dot { width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; box-shadow:0 2px 6px rgba(0,0,0,0.12); }
      .toggler-dot.one { background: #fff; opacity: .95; }
      .toggler-dot.two { background: rgba(255,255,255,0.75); }
      .toggler-dot.three { background: rgba(255,255,255,0.55); }

      /* small adjustments for light navbar search */
      .nav-search { background: rgba(255,255,255,0.12); border-radius:999px; padding: .25rem .5rem; color: rgba(255,255,255,0.95); border: 1px solid rgba(255,255,255,0.06); }

      /* keep navbar container slightly padded on mobile */
      @media (max-width: 991px) {
        .navbar-custom { padding: .5rem .6rem; }
        .navbar-custom .nav-pills .nav-link { margin: .2rem .15rem; }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-custom shadow-sm my-3 mx-3">
      <div class="container-fluid px-3">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
          <span class="d-flex align-items-center justify-content-center" style="width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#fff,rgba(255,255,255,0.85));box-shadow:0 6px 18px rgba(2,6,23,0.12);">
            <i class="bi bi-heart-pulse-fill text-gradient" style="font-size:18px;color:var(--nav-grad-1)"></i>
          </span>
          <span style="color:#fff">Diabetes prediction</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navmenu" aria-controls="navmenu" aria-expanded="false" aria-label="Toggle navigation">
          <span class="toggler-dot one"></span>
          <span class="toggler-dot two"></span>
          <span class="toggler-dot three"></span>
        </button>

        <div class="collapse navbar-collapse" id="navmenu">
          <ul class="navbar-nav ms-auto align-items-center nav-pills">
            <li class="nav-item"><a class="nav-link active" aria-current="page" href="/"><i class="bi bi-house-door-fill me-1"></i> Home</a></li>
            <li class="nav-item"><a class="nav-link" href="/docs"><i class="bi bi-book-half me-1"></i> Docs</a></li>
            <li class="nav-item"><a class="nav-link" href="/contact"><i class="bi bi-envelope-fill me-1"></i> Contact</a></li>
            <li class="nav-item"><a class="nav-link" href="/feedback"><i class="bi bi-chat-dots-fill me-1"></i> Feedback</a></li>

            <!-- subtle search box inside navbar -->
            

            <!-- CTA -->
            
          </ul>
        </div>
      </div>
    </nav>

    <main class="container py-4">
      <div class="row gy-4">
        <div class="col-12">
          <div class="card p-3">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
              <div>
                <h4 class="mb-0">Diabetes Risk Predictor</h4>
                <small class="text-muted"></small>
              </div>
              <div class="text-end">
                <button id="download-sample" class="btn btn-outline-secondary btn-sm"><i class="bi bi-download"></i> Sample CSV</button>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-6 col-md-8">
          <div class="card p-3">
            <form id="predict-form" class="row g-2 align-items-end">
              <div id="inputs-area" class="col-12"></div>
              <div class="col-12 d-flex gap-2 mt-2">
                <button type="submit" class="btn btn-primary"><i class="bi bi-activity"></i> Predict</button>
                <button id="download-btn" type="button" class="btn btn-outline-primary"><i class="bi bi-file-earmark-spreadsheet"></i> Download result</button>
                <button id="clear-btn" type="button" class="btn btn-light">Clear</button>
              </div>
            </form>
            <hr class="my-3">
            <div class="d-flex flex-column gap-2">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="gauge-legend">Prediction confidence</div>
                  <small class="text-muted">Higher → greater model probability of diabetes.</small>
                </div>
                <div class="text-end">
                  <span id="pred-label" class="badge bg-secondary">—</span>
                </div>
              </div>

              <div class="row align-items-center">
                <div class="col-auto">
                  <canvas id="gaugeCanvas" width="160" height="160"></canvas>
                </div>
                <div class="col">
                  <div class="progress" style="height:28px; border-radius:14px;">
                    <div id="prob-bar" class="progress-bar" role="progressbar" style="width:0%">0%</div>
                  </div>
                  <div class="mt-3">
                    <canvas id="historyChart" height="80"></canvas>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <div class="col-lg-6 col-md-8">
          <div class="card p-3">
            <h5 class="mb-2">Selected inputs & tips</h5>
            <ul>
              <li><strong>Glucose:</strong> fasting or random blood sugar reading.</li>
              <li><strong>BMI:</strong> indicator of obesity.</li>
              <li><strong>Blood Pressure:</strong> common vital sign.</li>
              <li><strong>Diabetes Pedigree Function:</strong> family history score from dataset.</li>
              <li>Enter <b>1</b>, if your family inherits from Diabetes , else enter <b>0</b></li>
              <li><strong>Age:</strong> years.</li>
            </ul>
            <hr>
            <p class="mb-0">Before predicting, go through the documentation</p>
            <hr>
            <h6>Interpretation</h6>
            <p class="mb-0">Probability ≥ 50%: model flags a higher risk.</p>
          </div>
        </div>

      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const features = {{ features | tojson }};
      const inputsArea = document.getElementById('inputs-area');
      features.forEach(f => {
        const id = 'f_' + f;
        const friendly = f.replace(/([A-Z])/g, ' $1');
        inputsArea.insertAdjacentHTML('beforeend', `
          <div class="col-12">
            <label class="form-label">${friendly}</label>
            <input id="${id}" name="${f}" class="form-control input-small" type="number" step="any" placeholder="${friendly}" required />
          </div>
        `);
      });

      const form = document.getElementById('predict-form');
      const probBar = document.getElementById('prob-bar');
      const predLabel = document.getElementById('pred-label');
      const historyCtx = document.getElementById('historyChart').getContext('2d');
      const historyChart = new Chart(historyCtx, { type: 'line', data: { labels: [], datasets: [{ label: 'Probability (%)', data: [], fill: true, tension: 0.3 }] }, options: { scales: { y: { min: 0, max: 100 } }, plugins: { legend: { display: false } } } });
      const gaugeCtx = document.getElementById('gaugeCanvas').getContext('2d');
      const gauge = new Chart(gaugeCtx, { type: 'doughnut', data: { datasets: [{ data: [0,100], circumference: 180, rotation: 270, cutout: '70%' }] }, options: { responsive: false, plugins: { legend: { display: false } }, tooltips: { enabled: false } } });
      function updateGauge(pct) { const rest = 100 - pct; gauge.data.datasets[0].data = [pct, rest]; gauge.data.datasets[0].backgroundColor = [pct >= 50 ? '#dc2626' : '#16a34a', '#e6eef9']; gauge.update(); }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = {};
        features.forEach(f => { payload[f] = parseFloat(document.getElementById('f_' + f).value) || 0; });
        const res = await fetch('/predict', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const data = await res.json();
        if (data.error) { alert('Error: ' + data.error); return; }
        const pct = Math.round(data.probability * 100);
        probBar.style.width = pct + '%'; probBar.textContent = pct + '%';
        probBar.classList.toggle('bg-danger', data.outcome === 1); probBar.classList.toggle('bg-success', data.outcome === 0);
        predLabel.textContent = (data.outcome === 1) ? 'High risk' : 'Low risk'; predLabel.className = 'badge ' + (data.outcome === 1 ? 'bg-danger' : 'bg-success');
        historyChart.data.labels.push(new Date().toLocaleTimeString()); historyChart.data.datasets[0].data.push(pct);
        if (historyChart.data.labels.length > 10) { historyChart.data.labels.shift(); historyChart.data.datasets[0].data.shift(); }
        historyChart.update(); updateGauge(pct);
        window.lastResult = {inputs: payload, probability: data.probability};
      });

      document.getElementById('download-btn').addEventListener('click', () => {
        const lr = window.lastResult || null; let csv = features.join(',') + ',Probability\n';
        if (lr) { const row = features.map(f => lr.inputs[f]).join(','); csv += row + ',' + Math.round(lr.probability*100)/100 + '\n'; } else { csv += '\n'; }
        const blob = new Blob([csv], {type: 'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'prediction_ui.csv'; a.click(); URL.revokeObjectURL(url);
      });

      document.getElementById('download-sample').addEventListener('click', () => { window.location.href = '/download/sample'; });
      document.getElementById('clear-btn').addEventListener('click', () => { features.forEach(f => { document.getElementById('f_' + f).value = ''; }); probBar.style.width = '0%'; probBar.textContent = '0%'; predLabel.textContent = '—'; predLabel.className = 'badge bg-secondary'; historyChart.data.labels = []; historyChart.data.datasets[0].data = []; historyChart.update(); updateGauge(0); window.lastResult = null; });
      updateGauge(0);
    </script>
  </body>
</html>
